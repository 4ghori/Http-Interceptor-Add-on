{"version":3,"sources":["scripts/background.js"],"names":["setTabRequestLog","key","dataToAppend","chrome","storage","local","get","json","log","push","set","setTabFilter","newFilter","filter","resetTab","getParameterByName","name","url","replace","regex","RegExp","results","exec","decodeURIComponent","_isContains","value","contains","Object","keys","some","_typeof","_isAdConfig","includes","_isAdType","adType","detectedAdType","Symbol","iterator","obj","constructor","prototype","activeTab","windowId","tabId","popupData","warningclass","rLog","runtime","onInstalled","addListener","details","console","previousVersion","tabs","query","active","clear","length","toString","data","onChanged","changes","areaName","newValue","onActivated","activeInfo","onUpdated","changeInfo","undefined","browserAction","setBadgeText","text","onRemoved","removeInfo","remove","webRequest","onBeforeRequest","overLoadedId","Banner Ad","Interstitial Ad","Incentivised Ad","Medium Rectangle Ad","placeguid","dataToStore","type","redirectUrl","urls","types"],"mappings":"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","file":"background.js","sourcesContent":["'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar activeTab = { windowId: -1, tabId: -1 };\nvar popupData = {\n  warningclass: 'hide',\n  rLog: ''\n};\n\n// ToDo Helper function( put in a seperate file)\nfunction setTabRequestLog(key, dataToAppend) {\n  chrome.storage.local.get(key, function (json) {\n    if (json[key]) {\n      json[key].log.push(dataToAppend);\n    } else {\n      return;\n    }\n    chrome.storage.local.set(json);\n  });\n}\n\nfunction setTabFilter(key, newFilter) {\n  chrome.storage.local.get(key, function (json) {\n    if (json[key]) {\n      json[key].filter = newFilter;\n    } else {\n      json[key] = { filter: newFilter, log: [] };\n    }\n    chrome.storage.local.set(json);\n  });\n}\n\nfunction resetTab(key) {\n  chrome.storage.local.get(key, function (json) {\n    if (json[key]) {\n      json[key] = { filter: json[key].filter, log: [] };\n      chrome.storage.local.set(json);\n    }\n  });\n}\n\nfunction getParameterByName(name, url) {\n  name = name.replace(/[\\[\\]]/g, '\\\\$&');\n  var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),\n      results = regex.exec(url);\n  if (!results) return null;\n  if (!results[2]) return '';\n  return decodeURIComponent(results[2].replace(/\\+/g, ' '));\n}\n\nfunction _isContains(json, value) {\n  var contains = false;\n  Object.keys(json).some(function (key) {\n    contains = _typeof(json[key]) === 'object' ? _isContains(json[key], value) : json[key] === value;\n    return contains;\n  });\n  return contains;\n}\n\nfunction _isAdConfig(url) {\n  if (url.includes('requestConfig.php?')) return true;else return false;\n}\n\nfunction _isAdType(url, adType) {\n  var detectedAdType = '';\n  if (getParameterByName('bdata', url)) {\n    if (getParameterByName('ver', url)) {\n      if (getParameterByName('hasDeal', url) && getParameterByName('callback', url)) {\n        detectedAdType = 'Incentivised Ad';\n      } else {\n        detectedAdType = 'Interstitial Ad';\n      }\n    } else {\n      detectedAdType = 'Medium Rectangle Ad';\n    }\n  } else {\n    detectedAdType = 'Banner Ad';\n  }\n  return detectedAdType == adType;\n}\n\nchrome.runtime.onInstalled.addListener(function (details) {\n  chrome.storage.local.set({ 'activeTab': { windowId: -1, tabId: -1 } });\n  console.log('previousVersion', details.previousVersion);\n});\n\nchrome.tabs.query({ active: true }, function (tabs) {\n  chrome.storage.local.clear();\n  if (tabs.length > 0) {\n    chrome.storage.local.set({ 'activeTab': { windowId: tabs[0].windowId, tabId: tabs[0].tabId } });\n    chrome.storage.local.get(tabs[0].tabId.toString(), function (data) {\n      if (data[tabs[0].tabId]) {\n        activeTab = { windowId: tabs[0].windowId, tabId: tabs[0].tabId, filter: data[tabs[0].tabId].filter };\n      } else {\n        activeTab = { windowId: tabs[0].windowId, tabId: tabs[0].tabId };\n      }\n    });\n  }\n});\nchrome.storage.onChanged.addListener(function (changes, areaName) {\n  if (changes.activeTab) {\n    if (changes.activeTab.newValue) {\n      var newValue = changes.activeTab.newValue;\n      if (newValue.tabId) {\n        chrome.storage.local.get(newValue.tabId.toString(), function (data) {\n          if (data[newValue.tabId]) {\n            activeTab = { windowId: newValue.windowId, tabId: newValue.tabId, filter: data[newValue.tabId].filter };\n          } else {\n            activeTab = { windowId: newValue.windowId, tabId: newValue.tabId };\n          }\n        });\n      }\n    }\n  }\n  if (changes[activeTab.tabId]) {\n    if (changes[activeTab.tabId].newValue) {\n      var newValue = changes[activeTab.tabId].newValue;\n      activeTab = { windowId: activeTab.windowId, tabId: activeTab.tabId, filter: newValue.filter };\n    }\n  }\n});\n\nchrome.tabs.onActivated.addListener(function (activeInfo) {\n  chrome.storage.local.set({ 'activeTab': { windowId: activeInfo.windowId, tabId: activeInfo.tabId } });\n  chrome.storage.local.get(activeInfo.tabId.toString(), function (data) {\n    if (data[activeInfo.tabId]) {\n      activeTab = { windowId: activeInfo.windowId, tabId: activeInfo.tabId, filter: data[activeInfo.tabId].filter };\n    } else {\n      activeTab = { windowId: activeInfo.windowId, tabId: activeInfo.tabId };\n    }\n  });\n});\n\nchrome.tabs.onUpdated.addListener(function (tabId, changeInfo) {\n  if (!(changeInfo.url === undefined)) {\n    chrome.browserAction.setBadgeText({ text: '', tabId: tabId });\n    console.log('lul');\n    resetTab(tabId.toString());\n  }\n});\n\nchrome.tabs.onRemoved.addListener(function (tabId, removeInfo) {\n  chrome.storage.local.remove(tabId.toString());\n});\n\nchrome.webRequest.onBeforeRequest.addListener(function (details) {\n  var overLoadedId = {\n    'Banner Ad': '5E88E58887',\n    'Interstitial Ad': 'F7B4F58641',\n    'Incentivised Ad': '21C5A58784',\n    'Medium Rectangle Ad': '4D2B658660'\n  };\n\n  if (details.tabId == activeTab.tabId && activeTab.filter) {\n    if (details.url.includes('rya') && details.url.includes('placeguid')) {\n      if (_isAdType(details.url, activeTab.filter.adType) || _isAdConfig(details.url)) {\n        var placeguid = getParameterByName('placeguid', details.url);\n        if (_isContains(overLoadedId, placeguid)) {\n          var dataToStore = { placeguid: getParameterByName('placeguid', details.url), url: details.url, type: 'success' };\n          setTabRequestLog(activeTab.tabId.toString(), dataToStore);\n          chrome.browserAction.setBadgeText({ text: '!', tabId: details.tabId });\n        } else {\n          var dataToStore = { placeguid: getParameterByName('placeguid', details.url), url: details.url, type: 'warning' };\n          setTabRequestLog(activeTab.tabId.toString(), dataToStore);\n          chrome.browserAction.setBadgeText({ text: '!', tabId: details.tabId });\n        }\n        return { redirectUrl: details.url.replace(/(placeguid=).*?(&|$)/, '$1' + overLoadedId[activeTab.filter.adType] + '$2') };\n      }\n    }\n  }\n}, {\n  urls: ['<all_urls>'],\n  types: ['main_frame', 'sub_frame', 'xmlhttprequest']\n}, ['blocking']);\n// chrome.webRequest.onCompleted.addListener(function(details){\n//   if (details.tabId==activeTab.tabId &&(details.url.includes(\"rya\") && details.url.includes(\"placeguid\"))){\n//     var currentTab = activeTab.tabId.toString();\n//     var dataToStore = {placeguid:getParameterByName('placeguid', details.url), url:details.url, type:'success'};\n//     setTabRequestLog(currentTab, dataToStore);\n//   }\n// },{\n//     urls: ['<all_urls>'],\n//     types: ['main_frame', 'sub_frame'],\n// });"]}